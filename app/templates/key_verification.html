{% extends "base.html" %}

{% block content %}
<div style="max-width: 600px; margin: 50px auto;">
    <div class="card">
        <div class="header">
            <h1>üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π</h1>
            <p>–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ—à–µ–ª—å–∫—É</p>
        </div>
        
        <div class="alert alert-success">
            –ö–ª—é—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –ø–æ—á—Ç—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∫–æ–º–∞–Ω–¥—ã!<br>
            <strong>–¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏:</strong> {{ session_token }}
        </div>
        
        <form id="verifyForm">
            <div class="form-group">
                <label for="keys_input">–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ –ø—Ä–æ–±–µ–ª):</label>
                <textarea id="keys_input" name="keys_input" rows="4" 
                         placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏..."
                         class="key-input" required></textarea>
            </div>
            
            <input type="hidden" id="session_token" name="session_token" value="{{ session_token }}">
            
            <button type="submit" class="btn" style="width: 100%;">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏ –∏ –≤–æ–π—Ç–∏
            </button>
        </form>
        
        <div id="result" style="margin-top: 20px;"></div>
    </div>
</div>

<script>
document.getElementById('verifyForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const resultDiv = document.getElementById('result');
    
    resultDiv.innerHTML = '<div class="alert">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–∏...</div>';
    
    fetch('/verify-keys', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            setTimeout(() => {
                window.location.href = data.redirect_url;
            }, 2000);
        } else {
            resultDiv.innerHTML = `<div class="alert alert-error">${data.message}</div>`;
        }
    })
    .catch(error => {
        resultDiv.innerHTML = `<div class="alert alert-error">–û—à–∏–±–∫–∞: ${error}</div>`;
    });
});
</script>
{% endblock %}