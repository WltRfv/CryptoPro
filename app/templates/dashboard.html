{% extends "base.html" %}

{% block content %}
<div class="nav">
    <h1 style="color: white;">üí∞ –ö—Ä–∏–ø—Ç–æ-–ö–æ—à–µ–ª–µ–∫: {{ team.name }}</h1>
    <div class="nav-links">
        <span style="color: white;">–ü—Ä–∏–≤–µ—Ç, {{ current_user.username }}!</span>
        <a href="{{ url_for('frontend.logout') }}">–í—ã–π—Ç–∏</a>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã -->
<div class="grid">
    <div class="stats-card">
        <h3>üèÜ –ë–∞–ª–ª—ã –∫–æ–º–∞–Ω–¥—ã</h3>
        <div class="stats-number">{{ team.total_points }}</div>
        <p>–í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤ —É –∫–æ–º–∞–Ω–¥—ã</p>
    </div>

    <div class="stats-card">
        <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
        <div class="stats-number">{{ members|length }}</div>
        <p>–ß–µ–ª–æ–≤–µ–∫ –≤ –∫–æ–º–∞–Ω–¥–µ</p>
    </div>

    <div class="stats-card">
        <h3>üíº –õ–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</h3>
        <div class="stats-number">{{ current_user.points }}</div>
        <p>–í–∞—à–∏ –ª–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</p>
    </div>
</div>

<div class="grid">
    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã -->
    <div class="card">
        <h2>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã</h2>
        <ul class="member-list">
            {% for member in members %}
            <li class="member-item">
                <div>
                    <strong>{{ member.username }}</strong>
                    <div style="color: #666; font-size: 0.9em;">{{ member.email }}</div>
                </div>
                <div style="font-weight: bold; color: #28a745;">
                    {{ member.points }} –±–∞–ª–ª–æ–≤
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤ -->
    <div class="card">
        <h2>üîÑ –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤</h2>
        <form method="POST" action="{{ url_for('frontend.transfer_points') }}">
            <div class="form-group">
                <label for="to_user_id">–ö–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏:</label>
                <select id="to_user_id" name="to_user_id" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                    {% for member in members %}
                        {% if member.id != current_user.id %}
                        <option value="{{ member.id }}">{{ member.username }} ({{ member.points }} –±–∞–ª–ª–æ–≤)</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="amount">–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:</label>
                <input type="number" id="amount" name="amount" min="1" max="{{ current_user.points }}" required>
            </div>

            <div class="form-group">
                <label for="personal_password">–í–∞—à –ø–∞—Ä–æ–ª—å:</label>
                <input type="password" id="personal_password" name="personal_password" required>
            </div>

            <button type="submit" class="btn">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã</button>
        </form>
    </div>
</div>

<!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
<div class="card">
    <h2>üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
    <div class="grid">
        {% for question in available_questions %}
        <div class="card" style="background: #f8f9fa;">
            <h3>{{ question.content }}</h3>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                <span style="font-weight: bold; color: #e83e8c; font-size: 1.2em;">
                    {{ question.price }} –±–∞–ª–ª–æ–≤
                </span>
                <form method="POST" action="{{ url_for('frontend.purchase_question') }}" style="margin: 0;">
                    <input type="hidden" name="question_id" value="{{ question.id }}">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <input type="password" name="personal_password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required
                               style="padding: 8px; font-size: 14px;">
                    </div>
                    <button type="submit" class="btn"
                            {% if current_user.points < question.price %}disabled{% endif %}>
                        –ö—É–ø–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–æ–ø—Ä–æ—Å -->
<div class="card">
    <h2>üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</h2>
    <form method="POST" action="{{ url_for('frontend.propose_question') }}">
        <div class="form-group">
            <label for="content">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞:</label>
            <textarea id="content" name="content" rows="3" required
                     placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..."></textarea>
        </div>

        <div class="form-group">
            <label for="price">–¶–µ–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ (–±–∞–ª–ª—ã):</label>
            <input type="number" id="price" name="price" min="10" required>
        </div>

        <button type="submit" class="btn">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
    </form>
</div>

<!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
<div class="grid">
    <!-- –ö—É–ø–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
    <div class="card">
        <h2>üõí –ö—É–ø–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
        {% if purchased_questions %}
            <ul class="member-list">
                {% for purchase in purchased_questions %}
                <li class="member-item">
                    <div>
                        <strong>{{ purchase.question.content }}</strong>
                        <div style="color: #666; font-size: 0.9em;">
                            –ö—É–ø–∏–ª: {{ purchase.purchased_by }}
                        </div>
                    </div>
                    <div style="color: #dc3545; font-weight: bold;">
                        -{{ purchase.question.price }}
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="text-align: center; color: #666; padding: 20px;">
                –ü–æ–∫–∞ –Ω–µ –∫—É–ø–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            </p>
        {% endif %}
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ -->
    <div class="card">
        <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤</h2>
        {% if transfers %}
            <ul class="member-list">
                {% for transfer in transfers %}
                <li class="member-item">
                    <div>
                        <strong>{{ transfer.sender.username }} ‚Üí {{ transfer.receiver.username }}</strong>
                        <div style="color: #666; font-size: 0.9em;">
                            {{ transfer.transferred_at.strftime('%d.%m.%Y %H:%M') }}
                        </div>
                    </div>
                    <div style="font-weight: bold; color: #28a745;">
                        {{ transfer.amount }} –±–∞–ª–ª–æ–≤
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="text-align: center; color: #666; padding: 20px;">
                –ü–æ–∫–∞ –Ω–µ –±—ã–ª–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}