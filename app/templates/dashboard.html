{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; color: white;">
    <h1>üí∞ CryptoPro –ö–æ—à–µ–ª–µ–∫</h1>
    <div>
        {% if current_user.is_authenticated %}
            <span>–ü—Ä–∏–≤–µ—Ç, {{ current_user.name }}!</span>
        {% else %}
            <span>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å CryptoPro</span>
            <a href="{{ url_for('frontend.personal_login') }}" class="btn" style="background: #28a745; margin-left: 10px;">üë§ –õ–∏—á–Ω—ã–π –≤—Ö–æ–¥</a>
        {% endif %}
        <a href="{{ url_for('frontend.logout') }}" class="btn" style="background: #dc3545; margin-left: 10px;">üö™ –í—ã–π—Ç–∏</a>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã -->
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
    <div class="card">
        <h3>üèÜ –ë–∞–ª–ª—ã –∫–æ–º–∞–Ω–¥—ã</h3>
        <div style="font-size: 2em; font-weight: bold; color: #667eea;">{{ team.total_points }}</div>
        <p>–í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤ —É –∫–æ–º–∞–Ω–¥—ã</p>
    </div>

    <div class="card">
        <h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
        <div style="font-size: 2em; font-weight: bold; color: #667eea;">{{ members|length }}</div>
        <p>–ß–µ–ª–æ–≤–µ–∫ –≤ –∫–æ–º–∞–Ω–¥–µ</p>
    </div>

    <div class="card">
        <h3>üíº –õ–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</h3>
        <div style="font-size: 2em; font-weight: bold; color: #667eea;">
            {% if current_user.is_authenticated %}
                {{ current_user.points }}
            {% else %}
                -
            {% endif %}
        </div>
        <p>–í–∞—à–∏ –ª–∏—á–Ω—ã–µ –±–∞–ª–ª—ã</p>
    </div>
</div>

{% if current_user.is_authenticated %}
<!-- –¢–æ–ª—å–∫–æ –¥–ª—è –≤–æ—à–µ–¥—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <!-- –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤ -->
    <div class="card">
        <h2>üîÑ –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤</h2>
        <form method="POST" action="{{ url_for('frontend.transfer_points') }}">
            <div class="form-group">
                <label for="to_member_id">–ö–æ–º—É –ø–µ—Ä–µ–≤–µ—Å—Ç–∏:</label>
                <select id="to_member_id" name="to_member_id" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                    {% for member in members %}
                        {% if member.id != current_user.id %}
                        <option value="{{ member.id }}">{{ member.name }} ({{ member.points }} –±–∞–ª–ª–æ–≤)</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="amount">–°—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:</label>
                <input type="number" id="amount" name="amount" min="1" max="{{ current_user.points }}" required>
            </div>

            <button type="submit" class="btn">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –±–∞–ª–ª—ã</button>
        </form>
    </div>

    <!-- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–æ–ø—Ä–æ—Å -->
    <div class="card">
        <h2>üí° –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</h2>
        <form method="POST" action="{{ url_for('frontend.propose_question') }}">
            <div class="form-group">
                <label for="content">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞:</label>
                <textarea id="content" name="content" rows="3" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..."></textarea>
            </div>

            <div class="form-group">
                <label for="price">–¶–µ–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ (–±–∞–ª–ª—ã):</label>
                <input type="number" id="price" name="price" min="10" required>
            </div>

            <button type="submit" class="btn">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
        </form>
    </div>
</div>

<!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
<div class="card">
    <h2>üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        {% for question in available_questions %}
        <div class="card" style="background: #f8f9fa;">
            <h4>{{ question.content }}</h4>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                <span style="font-weight: bold; color: #e83e8c;">{{ question.price }} –±–∞–ª–ª–æ–≤</span>
                <form method="POST" action="{{ url_for('frontend.purchase_question') }}" style="margin: 0;">
                    <input type="hidden" name="question_id" value="{{ question.id }}">
                    <button type="submit" class="btn" {% if current_user.points < question.price %}disabled{% endif %}>
                        –ö—É–ø–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                    </button>
                </form>
            </div>
            {% if current_user.points < question.price %}
            <p style="color: #dc3545; font-size: 0.9em; margin-top: 10px;">‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<!-- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
<div class="card" style="text-align: center; background: #fff3cd;">
    <h2>üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏—á–Ω—ã–π –≤—Ö–æ–¥</h2>
    <p>–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–µ—Ä–µ–≤–æ–¥—ã, –ø–æ–∫—É–ø–∫–∏) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</p>
    <a href="{{ url_for('frontend.personal_login') }}" class="btn" style="background: #28a745; margin-top: 15px;">
        üë§ –í–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
    </a>
</div>
{% endif %}

<!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
    <!-- –ö—É–ø–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
    <div class="card">
        <h2>üõí –ö—É–ø–ª–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
        {% if purchased_questions %}
            <div style="max-height: 300px; overflow-y: auto;">
                {% for purchase in purchased_questions %}
                <div style="padding: 10px; border-bottom: 1px solid #eee;">
                    <strong>{{ purchase.question.content }}</strong>
                    <div style="color: #666; font-size: 0.9em;">–ö—É–ø–∏–ª: {{ purchase.purchaser.name }}</div>
                    <div style="color: #dc3545; font-weight: bold;">-{{ purchase.question.price }} –±–∞–ª–ª–æ–≤</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="text-align: center; color: #666;">–ü–æ–∫–∞ –Ω–µ –∫—É–ø–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞</p>
        {% endif %}
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ -->
    <div class="card">
        <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤</h2>
        {% if transfers %}
            <div style="max-height: 300px; overflow-y: auto;">
                {% for transfer in transfers %}
                <div style="padding: 10px; border-bottom: 1px solid #eee;">
                    <strong>{{ transfer.from_member.name }} ‚Üí {{ transfer.to_member.name }}</strong>
                    <div style="color: #666; font-size: 0.9em;">{{ transfer.transferred_at.strftime('%d.%m.%Y %H:%M') }}</div>
                    <div style="font-weight: bold; color: #28a745;">{{ transfer.amount }} –±–∞–ª–ª–æ–≤</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="text-align: center; color: #666;">–ü–æ–∫–∞ –Ω–µ –±—ã–ª–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤</p>
        {% endif %}
    </div>
</div>
{% endblock %}