{% extends "base.html" %}

{% block content %}
<div style="max-width: 600px; margin: 40px auto;">
    <div class="card" style="text-align: center;">
        <div style="margin-bottom: 30px;">
            <h1>üöÄ CryptoPro –ö–æ—à–µ–ª–µ–∫</h1>
            <p style="color: #667eea; font-size: 1.1em; font-weight: 600;">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
        </div>

        <form method="POST">
            <button type="submit" class="btn btn-primary" style="width: 100%;">
                üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –Ω–∞ –ø–æ—á—Ç—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
            </button>
        </form>

        {% if session_token %}
        <div class="info-box" style="margin-top: 25px;">
            <h3 style="color: #1a535c; margin-bottom: 10px;">‚úÖ –ö–ª—é—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!</h3>
            <p style="margin-bottom: 8px; font-weight: 600;">–¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏: <strong>{{ session_token }}</strong></p>
            <p style="font-size: 0.95em; color: #1a535c;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
        </div>
        {% endif %}
    </div>

    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∫–ª—é—á–µ–π -->
    <div class="card">
        <h2>üîë –í–≤–æ–¥ –∫–ª—é—á–µ–π</h2>
        <form id="verifyForm">
            <div class="form-group">
                <label for="keys_input">–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–∏ (–º–∏–Ω–∏–º—É–º 3 –∏–∑ 4):</label>
                <textarea id="keys_input" name="keys_input" rows="4"
                         class="key-input"
                         placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–ª—é—á–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞ –ø–æ—á—Ç—É. –†–∞–∑–¥–µ–ª—è–π—Ç–µ –ø—Ä–æ–±–µ–ª–æ–º –∏–ª–∏ –∑–∞–ø—è—Ç–æ–π..."
                         required></textarea>
            </div>

            {% if session_token %}
            <input type="hidden" id="session_token" name="session_token" value="{{ session_token }}">
            {% endif %}

            <button type="submit" class="btn btn-success" style="width: 100%;">
                üöÄ –í–æ–π—Ç–∏ –≤ –∫–æ—à–µ–ª–µ–∫
            </button>
        </form>

        <div id="result" style="margin-top: 20px;"></div>
    </div>

    <div class="card info-box">
        <h3>üìß –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã</h3>
        <div class="email-list">
            <div class="email-item">samonov.135@gmail.com</div>
            <div class="email-item">galkinasnezana788@gmail.com</div>
            <div class="email-item">lesa85130@gmail.com</div>
            <div class="email-item">pravolavika@gmail.com</div>
        </div>
    </div>
</div>

<script>
document.getElementById('verifyForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const button = this.querySelector('button');
    const resultDiv = document.getElementById('result');

    button.disabled = true;
    button.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–∏...';
    resultDiv.innerHTML = '<div class="alert alert-info">üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∫–ª—é—á–µ–π...</div>';

    fetch('/verify-keys', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = '<div class="alert alert-success">' + data.message + ' –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–æ—à–µ–ª–µ–∫... üöÄ</div>';
            button.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ!';
            setTimeout(() => {
                window.location.href = data.redirect_url;
            }, 1500);
        } else {
            resultDiv.innerHTML = '<div class="alert alert-error">' + data.message + '</div>';
            button.disabled = false;
            button.textContent = 'üöÄ –í–æ–π—Ç–∏ –≤ –∫–æ—à–µ–ª–µ–∫';
        }
    })
    .catch(error => {
        resultDiv.innerHTML = '<div class="alert alert-error">–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error + '</div>';
        button.disabled = false;
        button.textContent = 'üöÄ –í–æ–π—Ç–∏ –≤ –∫–æ—à–µ–ª–µ–∫';
    });
});
</script>
{% endblock %}