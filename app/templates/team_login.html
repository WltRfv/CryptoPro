{% extends "base.html" %}

{% block content %}
<div style="max-width: 500px; margin: 100px auto;">
    <div class="card">
        <div class="header">
            <h1>üîê –ö–æ–º–∞–Ω–¥–Ω—ã–π –ö–æ—à–µ–ª–µ–∫</h1>
            <p>–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–ª—é—á–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
        </div>

        <form method="POST">
            <button type="submit" class="btn" style="width: 100%;">
                üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –Ω–∞ –ø–æ—á—Ç—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
            </button>
        </form>

        {% if session_token %}
        <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
            <h3>‚úÖ –ö–ª—é—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!</h3>
            <p>–¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏: <strong>{{ session_token }}</strong></p>
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –≤–≤–µ–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∏–∂–µ:</p>
        </div>
        {% endif %}
    </div>

    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∫–ª—é—á–µ–π -->
    <div class="card" style="margin-top: 20px;">
        <h2>üîë –í–≤–æ–¥ –∫–ª—é—á–µ–π</h2>
        <form id="verifyForm">
            <div class="form-group">
                <label for="keys_input">–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–∏ (–º–∏–Ω–∏–º—É–º 3):</label>
                <textarea id="keys_input" name="keys_input" rows="4"
                         placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–ª—é—á–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞ –ø–æ—á—Ç—É. –†–∞–∑–¥–µ–ª—è–π—Ç–µ –ø—Ä–æ–±–µ–ª–æ–º –∏–ª–∏ –∑–∞–ø—è—Ç–æ–π."
                         class="key-input" required></textarea>
            </div>

            {% if session_token %}
            <input type="hidden" id="session_token" name="session_token" value="{{ session_token }}">
            {% endif %}

            <button type="submit" class="btn" style="width: 100%;">
                üîì –í–æ–π—Ç–∏ –≤ –∫–æ—à–µ–ª–µ–∫
            </button>
        </form>

        <div id="result" style="margin-top: 20px;"></div>
    </div>

    <div class="card" style="margin-top: 20px; background: #f8f9fa;">
        <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <p><strong>–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥—ã:</strong></p>
        <ul style="margin-left: 20px;">
            <li>samonov.135@mail.ru</li>
            <li>galkinasnezana788@gmail.com</li>
            <li>lesa85130@gmail.com</li>
            <li>pravolavika@gmail.com</li>
        </ul>
        <p><strong>–î–ª—è –≤—Ö–æ–¥–∞ –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –∫–ª—é—á–∞ –∏–∑ 4</strong></p>
    </div>
</div>

<script>
document.getElementById('verifyForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const resultDiv = document.getElementById('result');

    resultDiv.innerHTML = '<div class="alert">üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–∏...</div>';

    fetch('/verify-keys', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            setTimeout(() => {
                window.location.href = data.redirect_url;
            }, 2000);
        } else {
            resultDiv.innerHTML = `<div class="alert alert-error">${data.message}</div>`;
        }
    })
    .catch(error => {
        resultDiv.innerHTML = `<div class="alert alert-error">–û—à–∏–±–∫–∞: ${error}</div>`;
    });
});
</script>
{% endblock %}